<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formul8 Multiagent Chat - SyzyChat Integration</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            margin: 10px 0;
            opacity: 0.9;
        }
        
        .tier-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .tier-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .tier-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .tier-button.active {
            background: white;
            color: #667eea;
            border-color: white;
        }
        
        .chat-wrapper {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 600px;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .chat-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .chat-header p {
            margin: 5px 0 0 0;
            opacity: 0.9;
        }
        
        #chat-container {
            height: 500px;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .feature-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .feature-description {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }
        
        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .status-indicator.error {
            background: #dc3545;
        }
        
        .status-indicator.warning {
            background: #ffc107;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-robot"></i> Formul8 Multiagent Chat</h1>
            <p>Intelligent cannabis industry AI assistant powered by SyzyChat</p>
            
            <!-- Tier Selector -->
            <div class="tier-selector">
                <button class="tier-button active" data-tier="free">Free</button>
                <button class="tier-button" data-tier="standard">Standard</button>
                <button class="tier-button" data-tier="micro">Micro</button>
                <button class="tier-button" data-tier="operator">Operator</button>
                <button class="tier-button" data-tier="enterprise">Enterprise</button>
                <button class="tier-button" data-tier="admin">Admin</button>
            </div>
        </div>
        
        <!-- Chat Interface -->
        <div class="chat-wrapper">
            <div class="chat-header">
                <h2 id="chatTitle">Formul8 Multiagent Chat</h2>
                <p id="chatSubtitle">Ask me anything about cannabis industry</p>
            </div>
            <div id="chat-container"></div>
        </div>
        
        <!-- Features -->
        <div class="features">
            <div class="feature-card">
                <div class="feature-icon">üî¨</div>
                <div class="feature-title">Science Agent</div>
                <div class="feature-description">Cannabinoid research, terpene analysis, and scientific insights</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">‚öóÔ∏è</div>
                <div class="feature-title">Formulation Agent</div>
                <div class="feature-description">Recipe development, dosage calculations, and product formulation</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üõ°Ô∏è</div>
                <div class="feature-title">Compliance Agent</div>
                <div class="feature-description">Regulatory guidance, licensing, and compliance management</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìà</div>
                <div class="feature-title">Marketing Agent</div>
                <div class="feature-description">Brand strategy, advertising, and customer acquisition</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üè≠</div>
                <div class="feature-title">Operations Agent</div>
                <div class="feature-description">Facility management, production, and quality control</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìã</div>
                <div class="feature-title">Patent Agent</div>
                <div class="feature-description">Intellectual property research and patent guidance</div>
            </div>
        </div>
    </div>
    
    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator">
        <i class="fas fa-check-circle"></i> Connected
    </div>

    <!-- SyzyChat Integration -->
    <script src="https://syzygyx.github.io/syzychat/syzychat.js"></script>
    <script>
        // Formul8 SyzyChat Integration
        class Formul8SyzyChat {
            constructor() {
                this.currentTier = 'free';
                this.chat = null;
                this.initializeChat();
                this.bindEvents();
                this.updateStatus('Connected', 'success');
            }
            
            initializeChat() {
                // Initialize SyzyChat with Formul8 configuration
                this.chat = new SyzyChat({
                    container: '#chat-container',
                    backendUrl: 'https://f8.syzygyx.com/api/chat',
                    openRouterApiKey: '', // Will be handled by backend
                    googleSheetsApiKey: '', // Not needed
                    config: {
                        enableTypingIndicator: true,
                        enableAgentRouting: true,
                        enableAdDelivery: true,
                        tier: this.currentTier,
                        maxMessageLength: 1000,
                        responseTimeout: 30000,
                        theme: 'formul8',
                        showAgentIndicators: true,
                        enableMultiTurn: true
                    },
                    // Custom message handlers
                    onMessage: (message) => this.handleMessage(message),
                    onAgentChange: (agent) => this.handleAgentChange(agent),
                    onError: (error) => this.handleError(error),
                    onTypingStart: () => this.showTypingIndicator(),
                    onTypingEnd: () => this.hideTypingIndicator()
                });
                
                // Initialize the chat
                this.chat.init();
            }
            
            bindEvents() {
                // Tier selector
                document.querySelectorAll('.tier-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const tier = e.target.dataset.tier;
                        this.setTier(tier);
                    });
                });
                
                // Custom keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'k') {
                        e.preventDefault();
                        this.focusChat();
                    }
                });
            }
            
            setTier(tier) {
                this.currentTier = tier;
                
                // Update UI
                document.querySelectorAll('.tier-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-tier="${tier}"]`).classList.add('active');
                
                // Update chat configuration
                if (this.chat) {
                    this.chat.updateConfig({ tier: tier });
                }
                
                // Update header
                this.updateHeader(tier);
                
                // Show tier-specific features
                this.showTierFeatures(tier);
            }
            
            updateHeader(tier) {
                const titles = {
                    'free': 'Formul8 Multiagent Chat - Free Tier',
                    'standard': 'Formul8 Multiagent Chat - Standard Tier',
                    'micro': 'Formul8 Multiagent Chat - Micro Tier',
                    'operator': 'Formul8 Multiagent Chat - Operator Tier',
                    'enterprise': 'Formul8 Multiagent Chat - Enterprise Tier',
                    'admin': 'Formul8 Multiagent Chat - Admin Tier'
                };
                
                const subtitles = {
                    'free': 'Basic cannabis industry assistance with upgrade prompts',
                    'standard': 'Advanced formulation tools and Future4200 search',
                    'micro': 'Enhanced compliance checking and marketing data',
                    'operator': 'Full cannabis business suite with all agents',
                    'enterprise': 'White-label solutions and custom integrations',
                    'admin': 'System management and editor capabilities'
                };
                
                document.getElementById('chatTitle').textContent = titles[tier];
                document.getElementById('chatSubtitle').textContent = subtitles[tier];
            }
            
            showTierFeatures(tier) {
                // This would show/hide features based on tier
                console.log(`Showing features for ${tier} tier`);
            }
            
            handleMessage(message) {
                console.log('Message received:', message);
                
                // Add custom Formul8-specific handling
                if (message.agent) {
                    this.showAgentIndicator(message.agent);
                }
                
                // Handle ad delivery for free tier
                if (this.currentTier === 'free' && message.type === 'ad') {
                    this.showAd(message.content);
                }
            }
            
            handleAgentChange(agent) {
                console.log('Agent changed to:', agent);
                this.showAgentIndicator(agent);
            }
            
            handleError(error) {
                console.error('Chat error:', error);
                this.updateStatus('Connection Error', 'error');
                
                // Retry connection after 5 seconds
                setTimeout(() => {
                    this.retryConnection();
                }, 5000);
            }
            
            showAgentIndicator(agent) {
                // Show which agent is responding
                const indicator = document.createElement('div');
                indicator.className = 'agent-indicator';
                indicator.innerHTML = `<i class="fas fa-robot"></i> Powered by ${agent}`;
                
                // This would be integrated with SyzyChat's message system
                console.log(`Agent indicator: ${agent}`);
            }
            
            showAd(content) {
                // Show upgrade ad for free tier
                const adDiv = document.createElement('div');
                adDiv.className = 'ad-banner';
                adDiv.innerHTML = content;
                
                // This would be integrated with SyzyChat's message system
                console.log('Showing ad:', content);
            }
            
            showTypingIndicator() {
                // SyzyChat handles this automatically
                console.log('Typing indicator shown');
            }
            
            hideTypingIndicator() {
                // SyzyChat handles this automatically
                console.log('Typing indicator hidden');
            }
            
            updateStatus(message, type = 'success') {
                const indicator = document.getElementById('statusIndicator');
                indicator.textContent = message;
                indicator.className = `status-indicator ${type}`;
                
                // Auto-hide after 3 seconds for success messages
                if (type === 'success') {
                    setTimeout(() => {
                        indicator.style.opacity = '0.7';
                    }, 3000);
                }
            }
            
            retryConnection() {
                console.log('Retrying connection...');
                this.updateStatus('Retrying...', 'warning');
                
                // Reinitialize chat
                this.initializeChat();
            }
            
            focusChat() {
                // Focus the chat input
                const chatInput = document.querySelector('#chat-container input, #chat-container textarea');
                if (chatInput) {
                    chatInput.focus();
                }
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.formul8Chat = new Formul8SyzyChat();
        });
        
        // Global functions for SyzyChat integration
        window.Formul8Chat = {
            setTier: (tier) => window.formul8Chat?.setTier(tier),
            sendMessage: (message) => window.formul8Chat?.chat?.sendMessage(message),
            getStatus: () => window.formul8Chat?.currentTier
        };
    </script>
    
    <!-- Font Awesome for icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
</body>
</html>